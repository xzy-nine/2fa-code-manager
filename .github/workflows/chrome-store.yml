name: Chrome Web Store Release

on:
  release:
    types: [published]

jobs:
  chrome-webstore:
    runs-on: ubuntu-latest
    if: github.event.release.prerelease == false
    
    steps:
    - name: Checkoutä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½®Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: å®‰è£…ä¾èµ–
      run: npm ci
      
    - name: æ„å»ºå’Œæ‰“åŒ…
      run: |
        npm run validate
        npm test
        npm run build
        
    - name: å‘å¸ƒåˆ°Chrome Web Store
      uses: PlasmoHQ/bpp@v3
      with:
        keys: ${{ secrets.CHROME_STORE_KEYS }}
        artifact: "*.zip"
        verbose: true
        
    - name: é€šçŸ¥å‘å¸ƒç»“æœ
      if: always()
      run: |
        if [ "${{ job.status }}" == "success" ]; then
          echo "ğŸ‰ Chromeæ‰©å±•å·²æˆåŠŸå‘å¸ƒåˆ°Web Store"
        else
          echo "âŒ Chromeæ‰©å±•å‘å¸ƒå¤±è´¥"
        fi
