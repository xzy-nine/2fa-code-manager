name: Chrome Web Store Release

on:
  release:
    types: [published]

jobs:
  chrome-webstore:
    runs-on: ubuntu-latest
    if: github.event.release.prerelease == false
    
    steps:
    - name: Checkout代码
      uses: actions/checkout@v4
      
    - name: 设置Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: 安装依赖
      run: npm ci
      
    - name: 构建和打包
      run: |
        npm run validate
        npm test
        npm run build
        
    - name: 发布到Chrome Web Store
      uses: PlasmoHQ/bpp@v3
      with:
        keys: ${{ secrets.CHROME_STORE_KEYS }}
        artifact: "*.zip"
        verbose: true
        
    - name: 通知发布结果
      if: always()
      run: |
        if [ "${{ job.status }}" == "success" ]; then
          echo "🎉 Chrome扩展已成功发布到Web Store"
        else
          echo "❌ Chrome扩展发布失败"
        fi
