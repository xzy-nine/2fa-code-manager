# 2FA验证码管家 - 浏览器扩展

一个功能强大的2FA验证码管理浏览器扩展，支持WebDAV云端同步、本地存储、二维码扫描和生物识别验证。

## 🚀 主要功能

### 核心功能
- **智能填充**: 自动识别2FA验证码输入框，一键填充验证码
- **云端同步**: 通过WebDAV服务器同步配置，支持多设备使用
- **本地存储**: 允许将常用配置存储在本地，离线使用
- **二维码扫描**: 支持摄像头扫描和屏幕识别两种方式导入配置

### 安全功能
- **加密存储**: 使用AES-GCM加密算法保护敏感数据
- **生物识别**: 支持Windows Hello等生物识别验证
- **分层保护**: 配置列表不加密，密钥数据强加密
- **自定义密钥**: 支持用户自定义加密密钥

### 智能特性
- **自动识别**: 智能识别页面中的2FA输入框
- **记忆功能**: 记住每个网站使用的配置，下次自动匹配
- **实时更新**: 本地验证码实时显示剩余时间和自动刷新
- **右键菜单**: 便捷的右键菜单快速操作

## 📦 安装使用

### 开发环境安装
1. 克隆或下载此项目
2. 打开Chrome浏览器，进入 `chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目根目录

### 首次配置
1. 点击扩展图标打开弹出页
2. 切换到"设置"标签页
3. 配置WebDAV服务器信息（可选）
4. 设置加密密钥（可选，留空使用简单加密）
5. 启用生物识别验证（可选）

## 🔧 使用指南

### 1. 导入2FA配置

#### 方法一：扫描二维码
1. 点击扩展图标，切换到"扫描"标签页
2. 选择"摄像头扫描"或"屏幕识别"
3. 扫描2FA设置页面的二维码
4. 输入配置名称并保存

#### 方法二：手动输入
1. 在设置中手动添加配置
2. 输入密钥、账户名、发行方等信息
3. 保存配置

### 2. 填充验证码

#### 快速填充
1. 在需要2FA验证的网页上点击验证码输入框
2. 点击扩展图标
3. 如果已有保存的配置，点击"快速填充"
4. 验证码自动填入输入框

#### 选择配置填充
1. 点击验证码输入框
2. 点击扩展图标
3. 进行身份验证（如果启用）
4. 点击"填充验证码"
5. 选择要使用的配置
6. 验证码自动填入

### 3. 本地验证码查看
1. 切换到"本地"标签页
2. 进行身份验证
3. 查看实时验证码和倒计时
4. 点击验证码复制到剪贴板

## ⚙️ 配置说明

### WebDAV设置
- **服务器地址**: 您的WebDAV服务器URL
- **用户名**: WebDAV账户用户名
- **密码**: WebDAV账户密码

支持的WebDAV服务：
- Nextcloud
- ownCloud
- 坚果云
- 其他兼容WebDAV协议的服务

### 加密设置
- **简单加密**: 留空密钥时使用，适合个人使用
- **自定义密钥**: 输入强密码，提供更高安全性
- **生物识别**: 启用后使用Windows Hello等进行身份验证

### 本地存储
- 允许将常用配置保存在浏览器本地存储
- 支持离线使用
- 需要身份验证才能查看

## 🔒 安全机制

### 数据保护
1. **分层加密**: 配置列表明文存储便于管理，密钥数据强加密保护
2. **密钥派生**: 使用PBKDF2算法派生加密密钥
3. **安全随机**: 使用加密安全的随机数生成器
4. **内存保护**: 敏感数据使用后立即清除

### 访问控制
1. **生物识别**: 支持平台原生的生物识别API
2. **会话管理**: 认证状态有时效性，需要定期重新认证
3. **权限最小化**: 只请求必要的浏览器权限

### 传输安全
1. **HTTPS传输**: WebDAV通信强制使用HTTPS
2. **端到端加密**: 数据在客户端加密后再传输
3. **完整性校验**: 数据包含完整性校验信息

## 🌐 兼容性

### 浏览器支持
- Chrome 88+
- Edge 88+
- Firefox（需要适配）
- Safari（需要适配）

### 平台支持
- Windows 10/11（完整功能）
- macOS（部分生物识别功能）
- Linux（基础功能）

### WebDAV服务器
- Nextcloud ✅
- ownCloud ✅
- 坚果云 ✅
- Synology ✅
- QNAP ✅
- 其他标准WebDAV ✅

## 🔧 开发说明

### 项目结构
```
2fa-xzy/
├── manifest.json          # 扩展清单
├── html/
│   └── popup.html         # 弹出页面
├── css/
│   └── popup.css          # 样式文件
├── js/
│   ├── popup.js           # 弹出页面逻辑
│   ├── background.js      # 背景脚本
│   ├── content.js         # 内容脚本
│   ├── crypto.js          # 加密模块
│   ├── totp.js            # TOTP算法模块
│   ├── webdav.js          # WebDAV客户端
│   └── qr-scanner.js      # 二维码扫描模块
└── favicon.png            # 图标
```

### 技术栈
- **前端**: HTML5, CSS3, JavaScript ES6+
- **加密**: Web Crypto API, AES-GCM
- **认证**: WebAuthn API
- **存储**: Chrome Storage API
- **网络**: Fetch API, WebDAV协议

### 核心模块

#### 1. CryptoManager (crypto.js)
- 负责数据的加密和解密
- 支持AES-GCM强加密和简单XOR加密
- 密钥派生和安全随机数生成

#### 2. TOTPGenerator (totp.js)
- 实现TOTP算法（RFC 6238）
- Base32解码和HMAC-SHA1计算
- 验证码生成和验证

#### 3. WebDAVClient (webdav.js)
- WebDAV协议客户端实现
- 支持文件上传、下载、删除等操作
- 配置管理和同步功能

#### 4. QRScanner (qr-scanner.js)
- 二维码识别算法
- 支持摄像头和屏幕录制
- OTP URI解析

## 🛠️ 故障排除

### 常见问题

**Q: 扩展无法识别验证码输入框？**
A: 检查输入框是否有相关的属性（id、class、placeholder等），手动点击输入框进行选择。

**Q: WebDAV连接失败？**
A: 确认服务器地址、用户名密码正确，服务器支持HTTPS，检查网络连接。

**Q: 生物识别不可用？**
A: 确认浏览器支持WebAuthn API，操作系统支持生物识别，已设置生物识别登录。

**Q: 验证码不正确？**
A: 检查系统时间是否准确，密钥是否正确，服务端时间同步。

### 调试方法
1. 打开浏览器开发者工具
2. 查看Console面板的错误信息
3. 检查Network面板的网络请求
4. 使用扩展的调试模式

## 📄 许可证

本项目基于 MIT 许可证开源。

## 🤝 贡献

欢迎提交Issue和Pull Request！

### 开发环境
1. Node.js 16+
2. 现代浏览器
3. WebDAV测试服务器（可选）

### 提交规范
- 遵循ESLint规则
- 添加必要的注释
- 编写测试用例
- 更新文档

## 📞 支持

如有问题或建议，请通过以下方式联系：
- GitHub Issues
- 邮箱: [您的邮箱]
- 社区论坛: [论坛链接]

---

**注意**: 本扩展处理敏感的身份验证信息，请确保在安全的环境中使用，定期备份配置数据。
