<!DOCTYPE html>
<html>
<head>
    <title>TOTP测试</title>
</head>
<body>
    <h1>TOTP库测试</h1>
    <div id="result"></div>
    
    <script src="js/lib/otpauth.umd.min.js"></script>
    <script src="js/totp.js"></script>
    <script>
        // 测试TOTP功能
        async function testTOTP() {
            try {
                console.log('开始测试TOTP...');
                
                // 创建TOTP生成器
                const totp = new TOTPGenerator();
                console.log('TOTP生成器创建成功');
                
                // 测试生成随机密钥
                const secret = totp.generateRandomSecret();
                console.log('生成的随机密钥:', secret);
                
                // 测试验证密钥格式
                const validation = totp.validateSecret(secret);
                console.log('密钥验证结果:', validation);
                
                // 测试生成验证码
                const code = await totp.generateTOTP(secret);
                console.log('生成的验证码:', code);
                
                // 测试获取当前代码信息
                const currentInfo = await totp.getCurrentCode(secret);
                console.log('当前代码信息:', currentInfo);
                
                // 测试验证代码
                const isValid = await totp.verifyTOTP(secret, code);
                console.log('代码验证结果:', isValid);
                
                // 测试URI生成和解析
                const uri = totp.generateOTPAuth(secret, 'test@example.com', 'TestApp');
                console.log('生成的URI:', uri);
                
                const parsed = totp.parseOTPAuth(uri);
                console.log('解析的URI信息:', parsed);
                
                document.getElementById('result').innerHTML = `
                    <h2>测试结果:</h2>
                    <p><strong>密钥:</strong> ${secret}</p>
                    <p><strong>验证码:</strong> ${code}</p>
                    <p><strong>剩余时间:</strong> ${currentInfo.timeRemaining}秒</p>
                    <p><strong>验证通过:</strong> ${isValid}</p>
                    <p><strong>URI:</strong> ${uri}</p>
                    <p style="color: green;">所有测试通过！</p>
                `;
                
            } catch (error) {
                console.error('测试失败:', error);
                document.getElementById('result').innerHTML = `
                    <h2 style="color: red;">测试失败:</h2>
                    <p>${error.message}</p>
                `;
            }
        }
        
        // 页面加载后执行测试
        window.addEventListener('load', testTOTP);
    </script>
</body>
</html>
